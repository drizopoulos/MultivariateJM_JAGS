{
    "contents" : "PwConst.DP.I <- function () {\n    for (i in 1:N) {\n        # Longitudinal Part -- Outcome 1\n        for (j in offset1[i]:(offset1[i+1] - 1)) {\n            muy1[j] <- inprod(betas1[1:ncX1], X1[j, 1:ncX1]) + \n                inprod(b[i, 1:ncZ1], Z1[j, 1:ncZ1])\n            y1[j] ~ dnorm(muy1[j], tau1)\n        }\n        # Longitudinal Part -- Outcome 2\n        for (j in offset2[i]:(offset2[i+1] - 1)) {\n            muy2[j] <- inprod(betas2[1:ncX1], X2[j, 1:ncX1]) + \n                inprod(b[i, (ncZ1 + 1):(ncZ1 + ncZ2)], Z2[j, 1:ncZ2])\n            y2[j] ~ dnorm(muy2[j], tau2)\n        }\n        # Longitudinal Part -- Outcome 3\n        for (j in offset3[i]:(offset3[i+1] - 1)) {\n            logit(PP[j]) <- inprod(betas3[1:ncX3], X3[j, 1:ncX3]) + \n                inprod(b[i, (ncZ1 + ncZ2 + 1):(ncZ1 + ncZ2 + ncZ3)], Z3[j, 1:ncZ3])\n            pr[j] <- max(0.00000001, min(0.99999999, PP[j]))\n            y3[j] ~ dbern(pr[j])\n        }\n        # Survival Part\n        etaBaseline[i] <- inprod(gammas[1:ncW], W[i, 1:ncW])\n        f1.T[i] <- inprod(betas1[1:ncX1], X1t[i, 1:ncX1]) + \n            inprod(b[i, 1:ncZ1], Z1t[i, 1:ncZ1])\n        f2.T[i] <- inprod(betas2[1:ncX2], X2t[i, 1:ncX1]) + \n            inprod(b[i, (ncZ1 + 1):(ncZ1 + ncZ2)], Z2t[i, 1:ncZ2])\n        f3.T[i] <- inprod(betas3[1:ncX3], X3t[i, 1:ncX1]) + \n            inprod(b[i, (ncZ1 + ncZ2 + 1):(ncZ1 + ncZ2 + ncZ3)], Z3t[i, 1:ncZ3])\n        for (q in 1:Q) {\n            log.hazard[i, q] <- D[i, q] * (log(xi[q]) + etaBaseline[i] + \n                                               alphas[1] * f1.T[i] + alphas[2] * f2.T[i] + \n                                               alphas[3] * f3.T[i])\n            # loop over the Gauss-Kronrod quadrature points\n            for (k in 1:15) {\n                f1.s[i, q, k] <- inprod(betas1[1:ncX1], X1s[Q*K*(i - 1) + K*(q - 1) + k, 1:ncX1]) + \n                    inprod(b[i, 1:ncZ1], Z1s[Q*K*(i - 1) + K*(q - 1) + k, 1:ncZ1])\n                f2.s[i, q, k] <- inprod(betas2[1:ncX2], X2s[Q*K*(i - 1) + K*(q - 1) + k, 1:ncX2]) + \n                    inprod(b[i, (ncZ1 + 1):(ncZ1 + ncZ2)], Z2s[Q*K*(i - 1) + K*(q - 1) + k, 1:ncZ2])\n                f3.s[i, q, k] <- inprod(betas3[1:ncX3], X3s[Q*K*(i - 1) + K*(q - 1) + k, 1:ncX3]) + \n                    inprod(b[i, (ncZ1 + ncZ2 + 1):(ncZ1 + ncZ2 + ncZ3)], \n                           Z3s[Q*K*(i - 1) + K*(q - 1) + k, 1:ncZ3])\n                SurvLong[i, q, k] <- wk[k] * exp(alphas[1] * f1.s[i, q, k] + \n                                                     alphas[2] * f2.s[i, q, k] + \n                                                     alphas[3] * f3.s[i, q, k])\n            }\n            approxIntegral[i, q] <- P[i, q] * sum(SurvLong[i, q, ])\n            log.survival[i, q] <- - xi[q] * exp(etaBaseline[i]) * approxIntegral[i, q]\n        }\n        phi[i] <- C - sum(log.hazard[i, ]) - sum(log.survival[i, ])\n        zeros[i] ~ dpois(phi[i])\n        # Random Effects Part\n        latent[i] ~ dcat(pis[1:R])\n        for (l in 1:nb) {\n            b[i, l] <- lambda[latent[i], l]\n        }\n        for (k in 1:R) {\n            memb[i, k] <- equals(latent[i], k)\n        }\n    }\n    # Priors\n    # Longitudinal Part -- Outcome 1\n    betas1[1:ncX1] ~ dmnorm(priorMean.betas1[], priorTau.betas1[, ])\n    tau1 ~ dgamma(priorA.tau1, priorB.tau1)\n    # Longitudinal Part -- Outcome 2\n    betas2[1:ncX2] ~ dmnorm(priorMean.betas2[], priorTau.betas2[, ])\n    tau2 ~ dgamma(priorA.tau2, priorB.tau2)\n    # Longitudinal Part -- Outcome 2\n    betas3[1:ncX3] ~ dmnorm(priorMean.betas3[], priorTau.betas3[, ])\n    # Survival Part\n    gammas[1:ncW] ~ dmnorm(priorMean.gammas[], priorTau.gammas[, ])\n    alphas[1:3] ~ dmnorm(priorMean.alphas[], priorTau.alphas[, ])\n    for (q in 1:Q) {\n        xi[q] ~ dgamma(priorA.xi[q], priorB.xi[q])\n    }\n    # Random Effects Part\n    for (k in 1:R) {\n        Tmemb[k] <- sum(memb[, k])\n        Fmemb[k] <- step(Tmemb[k] - 1)\n    }\n    Tcluster <- sum(Fmemb[])\n    # constructive DP\n    for (k in 1:R) {\n        r[k] ~ dbeta(1, rho)\n        lambda[k, 1:nb] ~ dmnorm(mu0[], inv.D[, ])\n    }\n    # stick-breaking\n    pis[1] <- r[1]\n    for (k in 2:(R-1)) {\n        log(pis[k]) <- log(r[k]) + sum(RR[k, 1:k-1])\n        for (l in 1:k-1) {\n            RR[k, l] <- log(1 - r[l])\n        }\n    }\n    pis[R] <- 1 - sum(pis[1:(R-1)])\n    inv.D[1:nb, 1:nb] ~ dwish(priorR.D[, ], priorK.D)   \n    rho ~ dgamma(priorA.rho, priorB.rho)\n}\n\nnamesPwConst.DP.I <- c(\n    \"N\", \"C\", \n    \"offset1\", \"y1\", \"X1\", \"X1t\", \"X1s\", \"Z1\", \"Z1t\", \"Z1s\", \"ncX1\", \"ncZ1\",\n    \"offset2\", \"y2\", \"X2\", \"X2t\", \"X2s\", \"Z2\", \"Z2t\", \"Z2s\", \"ncX2\", \"ncZ2\",\n    \"offset3\", \"y3\", \"X3\", \"X3t\", \"X3s\", \"Z3\", \"Z3t\", \"Z3s\", \"ncX3\", \"ncZ3\",\n    \"D\", \"Q\", \"P\", \"wk\", \"W\", \"ncW\", \"K\", \"zeros\",\n    \"nb\", \"mu0\", \"R\",\n    \"priorMean.betas1\", \"priorTau.betas1\", \"priorA.tau1\", \"priorB.tau1\",\n    \"priorMean.betas2\", \"priorTau.betas2\", \"priorA.tau2\", \"priorB.tau2\",\n    \"priorMean.betas3\", \"priorTau.betas3\",\n    \"priorMean.gammas\", \"priorTau.gammas\", \"priorMean.alphas\", \"priorTau.alphas\", \n    \"priorA.xi\", \"priorB.xi\", \"priorR.D\", \"priorK.D\", \"priorA.rho\", \"priorB.rho\"\n)\n\n###############################################################################################################\n###############################################################################################################\n\nPwConst.DP.III <- function () {\n    for (i in 1:N) {\n        # Longitudinal Part -- Outcome 1\n        for (j in offset1[i]:(offset1[i+1] - 1)) {\n            muy1[j] <- inprod(betas1[1:ncX1], X1[j, 1:ncX1]) + \n                inprod(b[i, 1:ncZ1], Z1[j, 1:ncZ1])\n            y1[j] ~ dnorm(muy1[j], tau1)\n        }\n        # Longitudinal Part -- Outcome 2\n        for (j in offset2[i]:(offset2[i+1] - 1)) {\n            muy2[j] <- inprod(betas2[1:ncX1], X2[j, 1:ncX1]) + \n                inprod(b[i, (ncZ1 + 1):(ncZ1 + ncZ2)], Z2[j, 1:ncZ2])\n            y2[j] ~ dnorm(muy2[j], tau2)\n        }\n        # Longitudinal Part -- Outcome 3\n        for (j in offset3[i]:(offset3[i+1] - 1)) {\n            logit(PP[j]) <- inprod(betas3[1:ncX3], X3[j, 1:ncX3]) + \n                inprod(b[i, (ncZ1 + ncZ2 + 1):(ncZ1 + ncZ2 + ncZ3)], Z3[j, 1:ncZ3])\n            pr[j] <- max(0.00000001, min(0.99999999, PP[j]))\n            y3[j] ~ dbern(pr[j])\n        }\n        # Survival Part\n        etaBaseline[i] <- inprod(gammas[1:ncW], W[i, 1:ncW]) + b[i, nb]\n        for (q in 1:Q) {\n            mu[i, q] <- xi[q] * exp(etaBaseline[i]) * T[i, q]\n            D[i, q] ~ dpois(mu[i, q])\n        }\n        # Random Effects Part\n        latent[i] ~ dcat(pis[1:R])\n        for (l in 1:nb) {\n            b[i, l] <- lambda[latent[i], l]\n        }\n        for (k in 1:R) {\n            memb[i, k] <- equals(latent[i], k)\n        }\n    }\n    # Priors\n    # Longitudinal Part -- Outcome 1\n    betas1[1:ncX1] ~ dmnorm(priorMean.betas1[], priorTau.betas1[, ])\n    tau1 ~ dgamma(priorA.tau1, priorB.tau1)\n    # Longitudinal Part -- Outcome 2\n    betas2[1:ncX2] ~ dmnorm(priorMean.betas2[], priorTau.betas2[, ])\n    tau2 ~ dgamma(priorA.tau2, priorB.tau2)\n    # Longitudinal Part -- Outcome 3\n    betas3[1:ncX3] ~ dmnorm(priorMean.betas3[], priorTau.betas3[, ])\n    # Survival Part\n    gammas[1:ncW] ~ dmnorm(priorMean.gammas[], priorTau.gammas[, ])\n    for (q in 1:Q) {\n        xi[q] ~ dgamma(priorA.xi[q], priorB.xi[q])\n    }\n    # Random Effects Part\n    for (k in 1:R) {\n        Tmemb[k] <- sum(memb[, k])\n        Fmemb[k] <- step(Tmemb[k] - 1)\n    }\n    Tcluster <- sum(Fmemb[])\n    # constructive DP\n    for (k in 1:R) {\n        r[k] ~ dbeta(1, rho)\n        lambda[k, 1:nb] ~ dmnorm(mu0[], inv.D[, ])\n    }\n    # stick-breaking\n    pis[1] <- r[1]\n    for (k in 2:(R-1)) {\n        log(pis[k]) <- log(r[k]) + sum(RR[k, 1:k-1])\n        for (l in 1:k-1) {\n            RR[k, l] <- log(1 - r[l])\n        }\n    }\n    pis[R] <- 1 - sum(pis[1:(R-1)])\n    inv.D[1:nb, 1:nb] ~ dwish(priorR.D[, ], priorK.D)   \n    rho ~ dgamma(priorA.rho, priorB.rho)\n}\n\nnamesPwConst.DP.III <- c(\n    \"N\", \n    \"offset1\", \"y1\", \"X1\", \"Z1\", \"ncX1\", \"ncZ1\",\n    \"offset2\", \"y2\", \"X2\", \"Z2\", \"ncX2\", \"ncZ2\",\n    \"offset3\", \"y3\", \"X3\", \"Z3\", \"ncX3\", \"ncZ3\",\n    \"D\", \"T\", \"Q\", \"W\", \"ncW\",\n    \"nb\", \"mu0\", \"R\",\n    \"priorMean.betas1\", \"priorTau.betas1\", \"priorA.tau1\", \"priorB.tau1\",\n    \"priorMean.betas2\", \"priorTau.betas2\", \"priorA.tau2\", \"priorB.tau2\",\n    \"priorMean.betas3\", \"priorTau.betas3\", \"priorMean.gammas\", \"priorTau.gammas\", \n    \"priorA.xi\", \"priorB.xi\", \"priorR.D\", \"priorK.D\", \"priorA.rho\", \"priorB.rho\"\n)\n\n###################################################################################################################\n###################################################################################################################\n\nmodelI <- function () {\n    for (i in 1:N) {\n        # Longitudinal Part\n        # Outcome 1\n        for (j in offset1[i]:(offset1[i + 1] - 1)){\n            y1[j] ~ dnorm(mu1[j], tau1)            \n            mu1[j] <- inprod(beta1.1[1:ncX1], X1[j, 1:ncX1]) + b[i, 1] + \n                inprod(beta1.2[1:(nk1-1)], Z1[j, 1:(nk1-1)]) + \n                inprod(b[i, 2:nk1], Z1[j, 1:(nk1-1)])\n            Z1[j, 1] <- Times1[j]\n            for (k in 2:(nk1-1)) {\n                P11[j, k] <- pow(max(Times1[j] - knots1[k], 0), 3)\n                P21[j, k] <- (knots1[nk1 - 1] - knots1[k]) * \n                    pow(max(Times1[j] - knots1[nk1], 0), 3)\n                P31[j, k] <- (knots1[nk1] - knots1[k]) * \n                    pow(max(Times1[j] - knots1[nk1 - 1], 0), 3)\n                Z1[j, k] <- P11[j, k] + \n                    (P21[j, k] - P31[j, k]) / (knots1[nk1] - knots1[nk1 - 1])\n            }\n        }\n        # Outcome 2\n        for (j in offset2[i]:(offset2[i + 1] - 1)){\n            y2[j] ~ dnorm(mu2[j], tau2)\n            mu2[j] <- inprod(beta2.1[1:ncX2], X2[j, 1:ncX2]) + b[i, nk1 + 1] + \n                inprod(beta2.2[1:(nk2-1)], Z2[j, 1:(nk2-1)]) + \n                inprod(b[i, (nk1 + 2):(nk1 + nk2)], Z2[j, 1:(nk2-1)])\n            Z2[j, 1] <- Times2[j]\n            for (k in 2:(nk2-1)) {\n                P12[j, k] <- pow(max(Times2[j] - knots2[k], 0), 3)\n                P22[j, k] <- (knots2[nk2 - 1] - knots2[k]) * pow(max(Times2[j] - knots2[nk2], 0), 3)\n                P32[j, k] <- (knots2[nk2] - knots2[k]) * pow(max(Times2[j] - knots2[nk2 - 1], 0), 3)\n                Z2[j, k] <- P12[j, k] + (P22[j, k] - P32[j, k]) / (knots2[nk2] - knots2[nk2 - 1])\n            }\n        }\n        # Outcome 3\n        for (j in offset3[i]:(offset3[i + 1] - 1)){\n            y3[j] ~ dbern(pr[j])\n            pr[j] <- max(0.0000000001, min(0.9999999999, P[j]))\n            logit(P[j]) <- inprod(beta3.1[1:ncX3], X3[j, 1:ncX3]) + b[i, nk1 + nk2 + 1] + \n                inprod(beta3.2[1:(nk3-1)], Z3[j, 1:(nk3-1)]) + \n                inprod(b[i, (nk1 + nk2 + 2):(nk1 + nk2 + nk3)], Z3[j, 1:(nk3-1)])\n            Z3[j, 1] <- Times3[j]\n            for (k in 2:(nk3-1)) {\n                P13[j, k] <- pow(max(Times3[j] - knots3[k], 0), 3)\n                P23[j, k] <- (knots3[nk3 - 1] - knots3[k]) * pow(max(Times3[j] - knots3[nk3], 0), 3)\n                P33[j, k] <- (knots3[nk3] - knots3[k]) * pow(max(Times3[j] - knots3[nk3 - 1], 0), 3)\n                Z3[j, k] <- P13[j, k] + (P23[j, k] - P33[j, k]) / (knots3[nk3] - knots3[nk3 - 1])\n            }\n        }\n        # Survival Part\n        etaBaseline[i] <- inprod(gamma[], W[i, ])\n        f1.T[i] <- beta1.1[1] + beta1.1[2]*W[i, 1] + beta1.1[3]*W[i, 2] + beta1.1[4]*W[i, 3] + b[i, 1] + \n            inprod(beta1.2[1:(nk1-1)], ZT1[i, 1:(nk1-1)]) + inprod(b[i, 2:nk1], ZT1[i, 1:(nk1-1)])\n        ZT1[i, 1] <- Time[i]\n        for (k in 2:(nk1-1)) {\n            PT11[i, k] <- pow(max(Time[i] - knots1[k], 0), 3)\n            PT21[i, k] <- (knots1[nk1 - 1] - knots1[k]) * pow(max(Time[i] - knots1[nk1], 0), 3)\n            PT31[i, k] <- (knots1[nk1] - knots1[k]) * pow(max(Time[i] - knots1[nk1 - 1], 0), 3)\n            ZT1[i, k] <- PT11[i, k] + (PT21[i, k] - PT31[i, k]) / (knots1[nk1] - knots1[nk1 - 1])\n        }    \n        f2.T[i] <- beta2.1[1] + beta2.1[2]*W[i, 1] + beta2.1[3]*W[i, 2] + \n            beta2.1[4]*W[i, 3] + b[i, nk1 + 1] + \n            inprod(beta2.2[1:(nk2-1)], ZT2[i, 1:(nk2-1)]) + \n            inprod(b[i, (nk1 + 2):(nk1 + nk2)], ZT2[i, 1:(nk2-1)])\n        ZT2[i, 1] <- Time[i]\n        for (k in 2:(nk2-1)) {\n            PT12[i, k] <- pow(max(Time[i] - knots2[k], 0), 3)\n            PT22[i, k] <- (knots2[nk2 - 1] - knots2[k]) * pow(max(Time[i] - knots2[nk2], 0), 3)\n            PT32[i, k] <- (knots2[nk2] - knots2[k]) * pow(max(Time[i] - knots2[nk2 - 1], 0), 3)\n            ZT2[i, k] <- PT12[i, k] + (PT22[i, k] - PT32[i, k]) / (knots2[nk2] - knots2[nk2 - 1])\n        }\n        f3.T[i] <- beta3.1[1] + beta3.1[2]*W[i, 1] + beta3.1[3]*W[i, 2] + \n            beta3.1[4]*W[i, 3] + b[i, nk1 + nk2 + 1] + \n            inprod(beta3.2[1:(nk3-1)], ZT3[i, 1:(nk3-1)]) + \n            inprod(b[i, (nk1 + nk2 + 2):(nk1 + nk2 + nk3)], ZT3[i, 1:(nk3-1)])\n        ZT3[i, 1] <- Time[i]\n        for (k in 2:(nk3-1)) {\n            PT13[i, k] <- pow(max(Time[i] - knots3[k], 0), 3)\n            PT23[i, k] <- (knots3[nk3 - 1] - knots3[k]) * pow(max(Time[i] - knots3[nk3], 0), 3)\n            PT33[i, k] <- (knots3[nk3] - knots3[k]) * pow(max(Time[i] - knots3[nk3 - 1], 0), 3)\n            ZT3[i, k] <- PT13[i, k] + (PT23[i, k] - PT33[i, k]) / (knots3[nk3] - knots3[nk3 - 1])\n        }\n        for (q in 1:Q) {\n            log.hazard[i, q] <- D[i, q] * (log(xi[q]) + etaBaseline[i] + \n                                               alpha[1]*f1.T[i] + alpha[2]*f2.T[i] + \n                                               alpha[3]*f3.T[i])\n            P1[i, q] <- (Up[i, q] + Lo[i, q]) / 2\n            P2[i, q] <- (Up[i, q] - Lo[i, q]) / 2\n            for (k in 1:15) {\n                su[i, q, k] <- P2[i, q] * sk[k] + P1[i, q]\n                f1.s[i, q, k] <- beta1.1[1] + beta1.1[2]*W[i, 1] + beta1.1[3]*W[i, 2] + \n                    beta1.1[4]*W[i, 3] + b[i, 1] + \n                            inprod(beta1.2[1:(nk1-1)], ZTs1[i, q, k, 1:(nk1-1)]) + \n                    inprod(b[i, 2:nk1], ZTs1[i, q, k, 1:(nk1-1)])\n                ZTs1[i, q, k, 1] <- su[i, q, k]\n                for (r in 2:(nk1-1)) {\n                    PTs11[i, q, k, r] <- pow(max(su[i, q, k] - knots1[r], 0), 3)\n                    PTs21[i, q, k, r] <- (knots1[nk1 - 1] - knots1[r]) * \n                        pow(max(su[i, q, k] - knots1[nk1], 0), 3)\n                    PTs31[i, q, k, r] <- (knots1[nk1] - knots1[r]) * \n                        pow(max(su[i, q, k] - knots1[nk1 - 1], 0), 3)\n                    ZTs1[i, q, k, r] <- PTs11[i, q, k, r] + \n                        (PTs21[i, q, k, r] - PTs31[i, q, k, r]) / (knots1[nk1] - knots1[nk1 - 1])\n                }\n                f2.s[i, q, k] <- beta2.1[1] + beta2.1[2]*W[i, 1] + beta2.1[3]*W[i, 2] + \n                    beta2.1[4]*W[i, 3] + b[i, nk1 + 1] + \n                            inprod(beta2.2[1:(nk2-1)], ZTs2[i, q, k, 1:(nk2-1)]) + \n                    inprod(b[i, (nk1 + 2):(nk1 + nk2)], ZTs2[i, q, k, 1:(nk2-1)])\n                ZTs2[i, q, k, 1] <- su[i, q, k]\n                for (r in 2:(nk2-1)) {\n                    PTs12[i, q, k, r] <- pow(max(su[i, q, k] - knots2[r], 0), 3)\n                    PTs22[i, q, k, r] <- (knots2[nk2 - 1] - knots2[r]) * \n                        pow(max(su[i, q, k] - knots2[nk2], 0), 3)\n                    PTs32[i, q, k, r] <- (knots2[nk2] - knots2[r]) * \n                        pow(max(su[i, q, k] - knots2[nk2 - 1], 0), 3)\n                    ZTs2[i, q, k, r] <- PTs12[i, q, k, r] + (PTs22[i, q, k, r] - \n                                                                 PTs32[i, q, k, r]) / (knots2[nk2] - knots2[nk2 - 1])\n                }\n                f3.s[i, q, k] <- beta3.1[1] + beta3.1[2]*W[i, 1] + beta3.1[3]*W[i, 2] + \n                    beta3.1[4]*W[i, 3] + b[i, nk1 + nk2 + 1] + \n                            inprod(beta3.2[1:(nk3-1)], ZTs3[i, q, k, 1:(nk3-1)]) + \n                    inprod(b[i, (nk1 + nk2 + 2):(nk1 + nk2 + nk3)], ZTs3[i, q, k, 1:(nk3-1)])\n                ZTs3[i, q, k, 1] <- su[i, q, k]\n                for (r in 2:(nk3-1)) {\n                    PTs13[i, q, k, r] <- pow(max(su[i, q, k] - knots3[r], 0), 3)\n                    PTs23[i, q, k, r] <- (knots3[nk3 - 1] - knots3[r]) * \n                        pow(max(su[i, q, k] - knots3[nk3], 0), 3)\n                    PTs33[i, q, k, r] <- (knots3[nk3] - knots3[r]) * \n                        pow(max(su[i, q, k] - knots3[nk3 - 1], 0), 3)\n                    ZTs3[i, q, k, r] <- PTs13[i, q, k, r] + \n                        (PTs23[i, q, k, r] - PTs33[i, q, k, r]) / (knots3[nk3] - knots3[nk3 - 1])\n                }\n                SurvLong[i, q, k] <- wk[k] * exp(alpha[1]*f1.s[i, q, k] + \n                                                     alpha[2]*f2.s[i, q, k] + \n                                                     alpha[3]*f3.s[i, q, k])\n            }\n            approxIntegral[i, q] <- P2[i, q] * sum(SurvLong[i, q, ])\n            log.survival[i, q] <- - xi[q] * exp(etaBaseline[i]) * approxIntegral[i, q]\n        }\n        zeros[i] <- 0\n        phi[i] <- - (sum(log.hazard[i, ]) + sum(log.survival[i, ])) + C\n        zeros[i] ~ dpois(phi[i])\n        # Random Effects Part\n        latent1[i] ~ dcat(pi1[1:L1])\n        for (l in 1:nb) {\n            b[i, l] <- lambda1[latent1[i], l]\n        }\n        # membership\n        for (k in 1:L1) {\n            memb1[i, k] <- equals(latent1[i], k)\n        }\n    }\n    # Priors\n    # Longitudinal Part -- Outcome 1\n    for (k in 1:ncX1) {\n        beta1.1[k] ~ dnorm(0, 0.8)\n    }\n    for (k in 1:(nk1-1)) {\n        beta1.2[k] ~ dnorm(0, 0.9)\n    }\n    tau1 ~ dgamma(1.01, 1.01)\n    # Longitudinal Part -- Outcome 2\n    for (k in 1:ncX2) {\n        beta2.1[k] ~ dnorm(0, 0.8)\n    }\n    for (k in 1:(nk2-1)) {\n        beta2.2[k] ~ dnorm(0, 0.9)\n    }\n    tau2 ~ dgamma(1.01, 1.01)\n    # Longitudinal Part -- Outcome 3\n    for (k in 1:ncX3) {\n        beta3.1[k] ~ dnorm(0, 0.8)\n    }\n    for (k in 1:(nk3-1)) {\n        beta3.2[k] ~ dnorm(0, 0.9)\n    }\n    # Survival Part\n    for (k in 1:ncW) {\n        gamma[k] ~ dnorm(0, 0.8)\n    }\n    for (q in 1:Q) {\n        xi[q] ~ dgamma(0.2, 0.2)\n    }\n    for (k in 1:3) {\n        alpha[k] ~ dnorm(0, 1.2)\n    }\n    # Random Effects Part\n    for (k in 1:L1) {\n        Tmemb1[k] <- sum(memb1[, k])\n        Fmemb1[k] <- step(Tmemb1[k] - 1)\n    }\n    Tcluster1 <- sum(Fmemb1[])\n    # constructive DP\n    for (k in 1:L1) {\n        r1[k] ~ dbeta(1, rho)\n        lambda1[k, 1:nb] ~ dmnorm(nu0[], Taunu[1:nb, 1:nb])\n    }\n    # stick-breaking\n    pi1[1] <- r1[1]\n    for (k in 2:(L1-1)) {\n        log(pi1[k]) <- log(r1[k]) + sum(R1[k, 1:k-1])\n        for (l in 1:k-1) {\n            R1[k, l] <- log(1 - r1[l])\n        }\n    }\n    pi1[L1] <- 1 - sum(pi1[1:(L1-1)])\n    for (k in 1:nb) {\n        nu0[k] <- 0\n    }\n    Taunu[1:nb, 1:nb] ~ dwish(RR[, ], 25)\n    ssigmab[1:nb, 1:nb] <- inverse(Taunu[, ])   \n    rho ~ dgamma(2, 0.01)\n}\n\nnamesI <- c(\n    \"N\", \"L1\", \"C\", \"nb\",\n    \"ncX1\", \"ncX2\", \"ncX3\",\n    \"nk1\", \"nk2\", \"nk3\",\n    \"knots1\", \"knots2\", \"knots3\",\n    \"offset1\", \"offset2\", \"offset3\",\n    \"y1\", \"y2\", \"y3\",    \n    \"X1\", \"X2\", \"X3\",\n    \"Times1\", \"Times2\", \"Times3\",\n    \"Time\", \"D\",\n    \"Lo\", \"Up\", \"W\", \"ncW\",\n    \"Q\", \"sk\", \"wk\", \"RR\"\n)\n\n#########################################################################\n\nmodelIV <- function () {\n    for (i in 1:N) {\n        # Longitudinal Part\n        # Outcome 1\n        for (j in offset1[i]:(offset1[i + 1] - 1)){\n            y1[j] ~ dnorm(mu1[j], tau1)            \n            mu1[j] <- inprod(beta1.1[1:ncX1], X1[j, 1:ncX1]) + b[i, 1] + \n                inprod(beta1.2[1:(nk1-1)], Z1[j, 1:(nk1-1)]) + \n                inprod(b[i, 2:nk1], Z1[j, 1:(nk1-1)])\n            Z1[j, 1] <- Times1[j]\n            for (k in 2:(nk1-1)) {\n                P11[j, k] <- pow(max(Times1[j] - knots1[k], 0), 3)\n                P21[j, k] <- (knots1[nk1 - 1] - knots1[k]) * pow(max(Times1[j] - knots1[nk1], 0), 3)\n                P31[j, k] <- (knots1[nk1] - knots1[k]) * pow(max(Times1[j] - knots1[nk1 - 1], 0), 3)\n                Z1[j, k] <- P11[j, k] + (P21[j, k] - P31[j, k]) / (knots1[nk1] - knots1[nk1 - 1])\n            }\n        }\n        # Outcome 2\n        for (j in offset2[i]:(offset2[i + 1] - 1)){\n            y2[j] ~ dnorm(mu2[j], tau2)\n            mu2[j] <- inprod(beta2.1[1:ncX2], X2[j, 1:ncX2]) + b[i, nk1 + 1] + \n                inprod(beta2.2[1:(nk2-1)], Z2[j, 1:(nk2-1)]) + \n                inprod(b[i, (nk1 + 2):(nk1 + nk2)], Z2[j, 1:(nk2-1)])\n            Z2[j, 1] <- Times2[j]\n            for (k in 2:(nk2-1)) {\n                P12[j, k] <- pow(max(Times2[j] - knots2[k], 0), 3)\n                P22[j, k] <- (knots2[nk2 - 1] - knots2[k]) * pow(max(Times2[j] - knots2[nk2], 0), 3)\n                P32[j, k] <- (knots2[nk2] - knots2[k]) * pow(max(Times2[j] - knots2[nk2 - 1], 0), 3)\n                Z2[j, k] <- P12[j, k] + (P22[j, k] - P32[j, k]) / (knots2[nk2] - knots2[nk2 - 1])\n            }\n        }\n        # Outcome 3\n        for (j in offset3[i]:(offset3[i + 1] - 1)){\n            y3[j] ~ dbern(pr[j])\n            pr[j] <- max(0.0000000001, min(0.9999999999, P[j]))\n            logit(P[j]) <- inprod(beta3.1[1:ncX3], X3[j, 1:ncX3]) + b[i, nk1 + nk2 + 1] + \n                inprod(beta3.2[1:(nk3-1)], Z3[j, 1:(nk3-1)]) + \n                inprod(b[i, (nk1 + nk2 + 2):(nk1 + nk2 + nk3)], Z3[j, 1:(nk3-1)])\n            Z3[j, 1] <- Times3[j]\n            for (k in 2:(nk3-1)) {\n                P13[j, k] <- pow(max(Times3[j] - knots3[k], 0), 3)\n                P23[j, k] <- (knots3[nk3 - 1] - knots3[k]) * pow(max(Times3[j] - knots3[nk3], 0), 3)\n                P33[j, k] <- (knots3[nk3] - knots3[k]) * pow(max(Times3[j] - knots3[nk3 - 1], 0), 3)\n                Z3[j, k] <- P13[j, k] + (P23[j, k] - P33[j, k]) / (knots3[nk3] - knots3[nk3 - 1])\n            }\n        }\n        # Survival Part\n        etaBaseline[i] <- inprod(gamma[], W[i, ])\n        f1.T[i] <- beta1.1[1] + beta1.1[2]*W[i, 1] + beta1.1[3]*W[i, 2] + beta1.1[4]*W[i, 3] + b[i, 1] + \n            inprod(beta1.2[1:(nk1-1)], ZT1[i, 1:(nk1-1)]) + inprod(b[i, 2:nk1], ZT1[i, 1:(nk1-1)])\n        ZT1[i, 1] <- Time[i]\n        for (k in 2:(nk1-1)) {\n            PT11[i, k] <- pow(max(Time[i] - knots1[k], 0), 3)\n            PT21[i, k] <- (knots1[nk1 - 1] - knots1[k]) * pow(max(Time[i] - knots1[nk1], 0), 3)\n            PT31[i, k] <- (knots1[nk1] - knots1[k]) * pow(max(Time[i] - knots1[nk1 - 1], 0), 3)\n            ZT1[i, k] <- PT11[i, k] + (PT21[i, k] - PT31[i, k]) / (knots1[nk1] - knots1[nk1 - 1])\n        }    \n        f2.T[i] <- beta2.1[1] + beta2.1[2]*W[i, 1] + beta2.1[3]*W[i, 2] + beta2.1[4]*W[i, 3] + b[i, nk1 + 1] + \n            inprod(beta2.2[1:(nk2-1)], ZT2[i, 1:(nk2-1)]) + inprod(b[i, (nk1 + 2):(nk1 + nk2)], ZT2[i, 1:(nk2-1)])\n        ZT2[i, 1] <- Time[i]\n        for (k in 2:(nk2-1)) {\n            PT12[i, k] <- pow(max(Time[i] - knots2[k], 0), 3)\n            PT22[i, k] <- (knots2[nk2 - 1] - knots2[k]) * pow(max(Time[i] - knots2[nk2], 0), 3)\n            PT32[i, k] <- (knots2[nk2] - knots2[k]) * pow(max(Time[i] - knots2[nk2 - 1], 0), 3)\n            ZT2[i, k] <- PT12[i, k] + (PT22[i, k] - PT32[i, k]) / (knots2[nk2] - knots2[nk2 - 1])\n        }\n        f3.T[i] <- beta3.1[1] + beta3.1[2]*W[i, 1] + beta3.1[3]*W[i, 2] + beta3.1[4]*W[i, 3] + b[i, nk1 + nk2 + 1] + \n            inprod(beta3.2[1:(nk3-1)], ZT3[i, 1:(nk3-1)]) + \n            inprod(b[i, (nk1 + nk2 + 2):(nk1 + nk2 + nk3)], ZT3[i, 1:(nk3-1)])\n        ZT3[i, 1] <- Time[i]\n        for (k in 2:(nk3-1)) {\n            PT13[i, k] <- pow(max(Time[i] - knots3[k], 0), 3)\n            PT23[i, k] <- (knots3[nk3 - 1] - knots3[k]) * pow(max(Time[i] - knots3[nk3], 0), 3)\n            PT33[i, k] <- (knots3[nk3] - knots3[k]) * pow(max(Time[i] - knots3[nk3 - 1], 0), 3)\n            ZT3[i, k] <- PT13[i, k] + (PT23[i, k] - PT33[i, k]) / (knots3[nk3] - knots3[nk3 - 1])\n        }\n        for (q in 1:Q) {\n            log.hazard[i, q] <- D[i, q] * (log(xi[q]) + etaBaseline[i] + \n                                               alpha[1]*f1.T[i] + alpha[2]*f2.T[i] + \n                                               alpha[3]*f3.T[i])\n            P1[i, q] <- (Up[i, q] + Lo[i, q]) / 2\n            P2[i, q] <- (Up[i, q] - Lo[i, q]) / 2\n            for (k in 1:15) {\n                su[i, q, k] <- P2[i, q] * sk[k] + P1[i, q]\n                f1.s[i, q, k] <- beta1.1[1] + beta1.1[2]*W[i, 1] + beta1.1[3]*W[i, 2] + \n                    beta1.1[4]*W[i, 3] + b[i, 1] + \n                            inprod(beta1.2[1:(nk1-1)], ZTs1[i, q, k, 1:(nk1-1)]) + \n                    inprod(b[i, 2:nk1], ZTs1[i, q, k, 1:(nk1-1)])\n                ZTs1[i, q, k, 1] <- su[i, q, k]\n                for (r in 2:(nk1-1)) {\n                    PTs11[i, q, k, r] <- pow(max(su[i, q, k] - knots1[r], 0), 3)\n                    PTs21[i, q, k, r] <- (knots1[nk1 - 1] - knots1[r]) * \n                        pow(max(su[i, q, k] - knots1[nk1], 0), 3)\n                    PTs31[i, q, k, r] <- (knots1[nk1] - knots1[r]) * \n                        pow(max(su[i, q, k] - knots1[nk1 - 1], 0), 3)\n                    ZTs1[i, q, k, r] <- PTs11[i, q, k, r] + \n                        (PTs21[i, q, k, r] - PTs31[i, q, k, r]) / (knots1[nk1] - knots1[nk1 - 1])\n                }\n                f2.s[i, q, k] <- beta2.1[1] + beta2.1[2]*W[i, 1] + beta2.1[3]*W[i, 2] + \n                    beta2.1[4]*W[i, 3] + b[i, nk1 + 1] + \n                            inprod(beta2.2[1:(nk2-1)], ZTs2[i, q, k, 1:(nk2-1)]) + \n                    inprod(b[i, (nk1 + 2):(nk1 + nk2)], ZTs2[i, q, k, 1:(nk2-1)])\n                ZTs2[i, q, k, 1] <- su[i, q, k]\n                for (r in 2:(nk2-1)) {\n                    PTs12[i, q, k, r] <- pow(max(su[i, q, k] - knots2[r], 0), 3)\n                    PTs22[i, q, k, r] <- (knots2[nk2 - 1] - knots2[r]) * \n                        pow(max(su[i, q, k] - knots2[nk2], 0), 3)\n                    PTs32[i, q, k, r] <- (knots2[nk2] - knots2[r]) * \n                        pow(max(su[i, q, k] - knots2[nk2 - 1], 0), 3)\n                    ZTs2[i, q, k, r] <- PTs12[i, q, k, r] + \n                        (PTs22[i, q, k, r] - PTs32[i, q, k, r]) / (knots2[nk2] - knots2[nk2 - 1])\n                }\n                f3.s[i, q, k] <- beta3.1[1] + beta3.1[2]*W[i, 1] + beta3.1[3]*W[i, 2] + \n                    beta3.1[4]*W[i, 3] + b[i, nk1 + nk2 + 1] + \n                            inprod(beta3.2[1:(nk3-1)], ZTs3[i, q, k, 1:(nk3-1)]) + \n                    inprod(b[i, (nk1 + nk2 + 2):(nk1 + nk2 + nk3)], ZTs3[i, q, k, 1:(nk3-1)])\n                ZTs3[i, q, k, 1] <- su[i, q, k]\n                for (r in 2:(nk3-1)) {\n                    PTs13[i, q, k, r] <- pow(max(su[i, q, k] - knots3[r], 0), 3)\n                    PTs23[i, q, k, r] <- (knots3[nk3 - 1] - knots3[r]) * pow(max(su[i, q, k] - knots3[nk3], 0), 3)\n                    PTs33[i, q, k, r] <- (knots3[nk3] - knots3[r]) * pow(max(su[i, q, k] - knots3[nk3 - 1], 0), 3)\n                    ZTs3[i, q, k, r] <- PTs13[i, q, k, r] + \n                        (PTs23[i, q, k, r] - PTs33[i, q, k, r]) / (knots3[nk3] - knots3[nk3 - 1])\n                }\n                SurvLong[i, q, k] <- wk[k] * exp(alpha[1]*f1.s[i, q, k] + \n                                                     alpha[2]*f2.s[i, q, k] + \n                                                     alpha[3]*f3.s[i, q, k])\n            }\n            approxIntegral[i, q] <- P2[i, q] * sum(SurvLong[i, q, ])\n            log.survival[i, q] <- - xi[q] * exp(etaBaseline[i]) * approxIntegral[i, q]\n        }\n        zeros[i] <- 0\n        phi[i] <- - (sum(log.hazard[i, ]) + sum(log.survival[i, ])) + C\n        zeros[i] ~ dpois(phi[i])\n        # Random Effects Part\n        latent1[i] ~ dcat(pi1[1:L1])\n        for (l in 1:nb) {\n            b[i, l] <- lambda1[latent1[i], l]\n        }\n        # membership\n        for (k in 1:L1) {\n            memb1[i, k] <- equals(latent1[i], k)\n        }\n    }\n    # Priors\n    # Longitudinal Part -- Outcome 1\n    for (k in 1:ncX1) {\n        beta1.1[k] ~ dnorm(0, 0.8)\n    }\n    for (k in 1:(nk1-1)) {\n        beta1.2[k] ~ dnorm(0, 0.9)\n    }\n    knots1[1] <- p.knots1[1] * (Diff1 - (nk1 + 1) * gap) + (start1 + gap)\n    for (r in 2:nk1) {\n        knots1[r] <- p.knots1[r] * (Diff1 - (nk1 + 1) * gap) + (knots1[r-1] + gap)\n    }\n    p.knots1[1] <- q.knots1[1]\n    q.knots1[1] ~ dbeta(a.knots1[1], b.knots1[1])\n    for (r in 2:nk1) {\n        b.knots1[r-1] <- a.knots1[r] + b.knots1[r] - 1\n        p.knots1[r] <- q.knots1[r] * (1 - q.knots1[r-1]) * p.knots1[r-1] / q.knots1[r-1]\n        q.knots1[r] ~ dbeta(a.knots1[r], b.knots1[r])\n    }\n    b.knots1[nk1] <- a.knots1[nk1 + 1]\n    for (r in 1:(nk1+1)) {\n        a.knots1[r] <- aeq.tau1\n    }\n    tau1 ~ dgamma(1.01, 1.01)\n    # Longitudinal Part -- Outcome 2\n    for (k in 1:ncX2) {\n        beta2.1[k] ~ dnorm(0, 0.8)\n    }\n    for (k in 1:(nk2-1)) {\n        beta2.2[k] ~ dnorm(0, 0.9)\n    }\n    knots2[1] <- p.knots2[1] * (Diff2 - (nk2 + 1) * gap) + (start2 + gap)\n    for (r in 2:nk2) {\n        knots2[r] <- p.knots2[r] * (Diff2 - (nk2 + 1) * gap) + (knots2[r-1] + gap)\n    }\n    p.knots2[1] <- q.knots2[1]\n    q.knots2[1] ~ dbeta(a.knots2[1], b.knots2[1])\n    for (r in 2:nk2) {\n        b.knots2[r-1] <- a.knots2[r] + b.knots2[r] - 1\n        p.knots2[r] <- q.knots2[r] * (1 - q.knots2[r-1]) * p.knots2[r-1] / q.knots2[r-1]\n        q.knots2[r] ~ dbeta(a.knots2[r], b.knots2[r])\n    }\n    b.knots2[nk2] <- a.knots2[nk2 + 1]\n    for (r in 1:(nk2+1)) {\n        a.knots2[r] <- aeq.tau2\n    }\n    tau2 ~ dgamma(1.01, 1.01)\n    # Longitudinal Part -- Outcome 3\n    for (k in 1:ncX3) {\n        beta3.1[k] ~ dnorm(0, 0.8)\n    }\n    for (k in 1:(nk3-1)) {\n        beta3.2[k] ~ dnorm(0, 0.9)\n    }\n    knots3[1] <- p.knots3[1] * (Diff3 - (nk3 + 1) * gap) + (start3 + gap)\n    for (r in 2:nk3) {\n        knots3[r] <- p.knots3[r] * (Diff3 - (nk3 + 1) * gap) + (knots3[r-1] + gap)\n    }\n    p.knots3[1] <- q.knots3[1]\n    q.knots3[1] ~ dbeta(a.knots3[1], b.knots3[1])\n    for (r in 2:nk3) {\n        b.knots3[r-1] <- a.knots3[r] + b.knots3[r] - 1\n        p.knots3[r] <- q.knots3[r] * (1 - q.knots3[r-1]) * p.knots3[r-1] / q.knots3[r-1]\n        q.knots3[r] ~ dbeta(a.knots3[r], b.knots3[r])\n    }\n    b.knots3[nk3] <- a.knots3[nk3 + 1]\n    for (r in 1:(nk3+1)) {\n        a.knots3[r] <- aeq.tau3\n    }\n    # Survival Part\n    for (k in 1:ncW) {\n        gamma[k] ~ dnorm(0, 0.8)\n    }\n    for (q in 1:Q) {\n        xi[q] ~ dgamma(0.2, 0.2)\n    }\n    for (k in 1:3) {\n        alpha[k] ~ dnorm(0, 1.2)\n    }\n    # Random Effects Part\n    for (k in 1:L1) {\n        Tmemb1[k] <- sum(memb1[, k])\n        Fmemb1[k] <- step(Tmemb1[k] - 1)\n    }\n    Tcluster1 <- sum(Fmemb1[])\n    # constructive DP\n    for (k in 1:L1) {\n        r1[k] ~ dbeta(1, rho)\n        lambda1[k, 1:nb] ~ dmnorm(nu0[], Taunu[1:nb, 1:nb])\n    }\n    # stick-breaking\n    pi1[1] <- r1[1]\n    for (k in 2:(L1-1)) {\n        log(pi1[k]) <- log(r1[k]) + sum(R1[k, 1:k-1])\n        for (l in 1:k-1) {\n            R1[k, l] <- log(1 - r1[l])\n        }\n    }\n    pi1[L1] <- 1 - sum(pi1[1:(L1-1)])\n    for (k in 1:nb) {\n        nu0[k] <- 0\n    }\n    Taunu[1:nb, 1:nb] ~ dwish(RR[, ], 25)\n    ssigmab[1:nb, 1:nb] <- inverse(Taunu[, ])   \n    rho ~ dgamma(2, 0.01)\n}\n\nnamesIV <- c(\n    \"N\", \"L1\", \"gap\", \"C\", \"nb\",\n    \"ncX1\", \"ncX2\", \"ncX3\",\n    \"nk1\", \"nk2\", \"nk3\",\n    \"aeq.tau1\", \"aeq.tau2\", \"aeq.tau3\",\n    \"Diff1\", \"Diff2\", \"Diff3\",\n    \"start1\", \"start2\", \"start3\",\n    \"offset1\", \"offset2\", \"offset3\",\n    \"y1\", \"y2\", \"y3\",    \n    \"X1\", \"X2\", \"X3\",\n    \"Times1\", \"Times2\", \"Times3\",\n    \"Time\", \"D\",\n    \"Lo\", \"Up\", \"W\", \"ncW\",\n    \"Q\", \"sk\", \"wk\", \"RR\"\n)\n\n#########################################################################\n\nmodelVI <- function () {\n    for (i in 1:N) {\n        # Longitudinal Part\n        # Outcome 1\n        for (j in offset1[i]:(offset1[i + 1] - 1)){\n            y1[j] ~ dnorm(mu1[j], tau1)            \n            mu1[j] <- inprod(beta1.1[1:ncX1], X1[j, 1:ncX1]) + b[i, 1] + \n                inprod(beta1.2[1:(nk1-1)], Z1[j, 1:(nk1-1)]) + \n                inprod(b[i, 2:nk1], Z1[j, 1:(nk1-1)])\n            Z1[j, 1] <- Times1[j]\n            for (k in 2:(nk1-1)) {\n                P11[j, k] <- pow(max(Times1[j] - knots1[k], 0), 3)\n                P21[j, k] <- (knots1[nk1 - 1] - knots1[k]) * pow(max(Times1[j] - knots1[nk1], 0), 3)\n                P31[j, k] <- (knots1[nk1] - knots1[k]) * pow(max(Times1[j] - knots1[nk1 - 1], 0), 3)\n                Z1[j, k] <- P11[j, k] + (P21[j, k] - P31[j, k]) / (knots1[nk1] - knots1[nk1 - 1])\n            }\n        }\n        # Outcome 2\n        for (j in offset2[i]:(offset2[i + 1] - 1)){\n            y2[j] ~ dnorm(mu2[j], tau2)\n            mu2[j] <- inprod(beta2.1[1:ncX2], X2[j, 1:ncX2]) + b[i, nk1 + 1] + \n                inprod(beta2.2[1:(nk2-1)], Z2[j, 1:(nk2-1)]) + \n                inprod(b[i, (nk1 + 2):(nk1 + nk2)], Z2[j, 1:(nk2-1)])\n            Z2[j, 1] <- Times2[j]\n            for (k in 2:(nk2-1)) {\n                P12[j, k] <- pow(max(Times2[j] - knots2[k], 0), 3)\n                P22[j, k] <- (knots2[nk2 - 1] - knots2[k]) * pow(max(Times2[j] - knots2[nk2], 0), 3)\n                P32[j, k] <- (knots2[nk2] - knots2[k]) * pow(max(Times2[j] - knots2[nk2 - 1], 0), 3)\n                Z2[j, k] <- P12[j, k] + (P22[j, k] - P32[j, k]) / (knots2[nk2] - knots2[nk2 - 1])\n            }\n        }\n        # Outcome 3\n        for (j in offset3[i]:(offset3[i + 1] - 1)){\n            y3[j] ~ dbern(pr[j])\n            pr[j] <- max(0.0000000001, min(0.9999999999, P[j]))\n            logit(P[j]) <- inprod(beta3.1[1:ncX3], X3[j, 1:ncX3]) + b[i, nk1 + nk2 + 1] + \n                inprod(beta3.2[1:(nk3-1)], Z3[j, 1:(nk3-1)]) + \n                inprod(b[i, (nk1 + nk2 + 2):(nk1 + nk2 + nk3)], Z3[j, 1:(nk3-1)])\n            Z3[j, 1] <- Times3[j]\n            for (k in 2:(nk3-1)) {\n                P13[j, k] <- pow(max(Times3[j] - knots3[k], 0), 3)\n                P23[j, k] <- (knots3[nk3 - 1] - knots3[k]) * pow(max(Times3[j] - knots3[nk3], 0), 3)\n                P33[j, k] <- (knots3[nk3] - knots3[k]) * pow(max(Times3[j] - knots3[nk3 - 1], 0), 3)\n                Z3[j, k] <- P13[j, k] + (P23[j, k] - P33[j, k]) / (knots3[nk3] - knots3[nk3 - 1])\n            }\n        }\n        # Survival Part\n        etaBaseline[i] <- inprod(gammas[], W[i, ]) + b[i, nk1 + nk2 + nk3 + 1]\n        for (q in 1:Q) {\n            mu[i, q] <- xi[q] * exp(etaBaseline[i]) * T[i, q]\n            D[i, q] ~ dpois(mu[i, q])\n        }\n        # Random Effects Part\n        latent1[i] ~ dcat(pi1[1:L1])\n        for (l in 1:nb) {\n            b[i, l] <- lambda1[latent1[i], l]\n        }\n        # membership\n        for (k in 1:L1) {\n            memb1[i, k] <- equals(latent1[i], k)\n        }\n    }\n    # Priors\n    # Longitudinal Part -- Outcome 1\n    for (k in 1:ncX1) {\n        beta1.1[k] ~ dnorm(0, 0.01)\n    }\n    for (k in 1:(nk1-1)) {\n        beta1.2[k] ~ dnorm(0, 0.01)\n    }\n    knots1[1] <- p.knots1[1] * (Diff1 - (nk1 + 1) * gap) + (start1 + gap)\n    for (r in 2:nk1) {\n        knots1[r] <- p.knots1[r] * (Diff1 - (nk1 + 1) * gap) + (knots1[r-1] + gap)\n    }\n    p.knots1[1] <- q.knots1[1]\n    q.knots1[1] ~ dbeta(a.knots1[1], b.knots1[1])\n    for (r in 2:nk1) {\n        b.knots1[r-1] <- a.knots1[r] + b.knots1[r] - 1\n        p.knots1[r] <- q.knots1[r] * (1 - q.knots1[r-1]) * p.knots1[r-1] / q.knots1[r-1]\n        q.knots1[r] ~ dbeta(a.knots1[r], b.knots1[r])\n    }\n    b.knots1[nk1] <- a.knots1[nk1 + 1]\n    for (r in 1:(nk1+1)) {\n        a.knots1[r] <- aeq.tau1\n    }\n    tau1 ~ dgamma(1.01, 1.01)\n    # Longitudinal Part -- Outcome 2\n    for (k in 1:ncX2) {\n        beta2.1[k] ~ dnorm(0, 0.01)\n    }\n    for (k in 1:(nk2-1)) {\n        beta2.2[k] ~ dnorm(0, 0.01)\n    }\n    knots2[1] <- p.knots2[1] * (Diff2 - (nk2 + 1) * gap) + (start2 + gap)\n    for (r in 2:nk2) {\n        knots2[r] <- p.knots2[r] * (Diff2 - (nk2 + 1) * gap) + (knots2[r-1] + gap)\n    }\n    p.knots2[1] <- q.knots2[1]\n    q.knots2[1] ~ dbeta(a.knots2[1], b.knots2[1])\n    for (r in 2:nk2) {\n        b.knots2[r-1] <- a.knots2[r] + b.knots2[r] - 1\n        p.knots2[r] <- q.knots2[r] * (1 - q.knots2[r-1]) * p.knots2[r-1] / q.knots2[r-1]\n        q.knots2[r] ~ dbeta(a.knots2[r], b.knots2[r])\n    }\n    b.knots2[nk2] <- a.knots2[nk2 + 1]\n    for (r in 1:(nk2+1)) {\n        a.knots2[r] <- aeq.tau2\n    }\n    tau2 ~ dgamma(1.01, 1.01)\n    # Longitudinal Part -- Outcome 3\n    for (k in 1:ncX3) {\n        beta3.1[k] ~ dnorm(0, 0.01)\n    }\n    for (k in 1:(nk3-1)) {\n        beta3.2[k] ~ dnorm(0, 0.01)\n    }\n    knots3[1] <- p.knots3[1] * (Diff3 - (nk3 + 1) * gap) + (start3 + gap)\n    for (r in 2:nk3) {\n        knots3[r] <- p.knots3[r] * (Diff3 - (nk3 + 1) * gap) + (knots3[r-1] + gap)\n    }\n    p.knots3[1] <- q.knots3[1]\n    q.knots3[1] ~ dbeta(a.knots3[1], b.knots3[1])\n    for (r in 2:nk3) {\n        b.knots3[r-1] <- a.knots3[r] + b.knots3[r] - 1\n        p.knots3[r] <- q.knots3[r] * (1 - q.knots3[r-1]) * p.knots3[r-1] / q.knots3[r-1]\n        q.knots3[r] ~ dbeta(a.knots3[r], b.knots3[r])\n    }\n    b.knots3[nk3] <- a.knots3[nk3 + 1]\n    for (r in 1:(nk3+1)) {\n        a.knots3[r] <- aeq.tau3\n    }\n    # Survival Part\n    for (k in 1:ncW) {\n        gammas[k] ~ dnorm(0, 2.5)\n    }\n    for (q in 1:Q) {\n        xi[q] ~ dgamma(0.2, 0.2)\n    }\n    # Random Effects Part\n    for (k in 1:L1) {\n        Tmemb1[k] <- sum(memb1[, k])\n        Fmemb1[k] <- step(Tmemb1[k] - 1)\n    }\n    Tcluster1 <- sum(Fmemb1[])\n    # constructive DP\n    for (k in 1:L1) {\n        r1[k] ~ dbeta(1, rho)\n        lambda1[k, 1:nb] ~ dmnorm(nu0[], Taunu[1:nb, 1:nb])\n    }\n    # stick-breaking\n    pi1[1] <- r1[1]\n    for (k in 2:(L1-1)) {\n        log(pi1[k]) <- log(r1[k]) + sum(R1[k, 1:k-1])\n        for (l in 1:k-1) {\n            R1[k, l] <- log(1 - r1[l])\n        }\n    }\n    pi1[L1] <- 1 - sum(pi1[1:(L1-1)])\n    for (k in 1:nb) {\n        nu0[k] <- 0\n    }\n    Taunu[1:nb, 1:nb] ~ dwish(RR[, ], 25)\n    ssigmab[1:nb, 1:nb] <- inverse(Taunu[, ])   \n    rho ~ dgamma(2, 0.01)\n}\n\nnamesVI <- c(\n    \"N\", \"L1\", \"gap\", \"nb\",\n    \"ncX1\", \"ncX2\", \"ncX3\",\n    \"nk1\", \"nk2\", \"nk3\",\n    \"aeq.tau1\", \"aeq.tau2\", \"aeq.tau3\",\n    \"Diff1\", \"Diff2\", \"Diff3\",\n    \"start1\", \"start2\", \"start3\",\n    \"offset1\", \"offset2\", \"offset3\",\n    \"y1\", \"y2\", \"y3\",    \n    \"X1\", \"X2\", \"X3\",\n    \"Times1\", \"Times2\", \"Times3\",\n    \"T\", \"D\",\n    \"W\", \"ncW\", \"Q\", \"RR\"\n)\n",
    "created" : 1446146688499.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "3297048203",
    "id" : "CE65A80A",
    "lastKnownWriteTime" : 1446147000,
    "path" : "C:/Users/Dimitris/Documents/PackagesGitHub/MultivariateJM_JAGS/Rpgm/Models.R",
    "project_path" : "Rpgm/Models.R",
    "properties" : {
    },
    "relative_order" : 3,
    "source_on_save" : false,
    "type" : "r_source"
}